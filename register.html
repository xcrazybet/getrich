<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GetRich - Register</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* Your existing CSS here */
    </style>
</head>
<body>
    <!-- Your existing HTML here -->
    
    <script>
        // ============================================
        // WORKING SUPABASE CONFIGURATION
        // ============================================
        const SUPABASE_URL = 'https://YOUR-PROJECT-ID.supabase.co';
        const SUPABASE_ANON_KEY = 'YOUR-ANON-KEY-HERE';
        
        // Initialize Supabase
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Generate a random password for users
        function generatePassword() {
            return 'Pass' + Math.random().toString(36).slice(-8) + '123!';
        }
        
        // Register user function
        async function registerUser(userData) {
            try {
                // Generate a secure password
                const password = generatePassword();
                
                // Create user with Supabase Auth
                const { data, error } = await supabase.auth.signUp({
                    email: userData.email,
                    password: password,
                    options: {
                        data: {
                            full_name: userData.full_name,
                            username: userData.username,
                            phone: userData.phone || '',
                            is_over_21: userData.is_over_21,
                            agreed_to_terms: userData.agreed_to_terms,
                            receive_promotions: userData.receive_promotions
                        },
                        emailRedirectTo: 'https://xraybet.github.io/getrich/success.html'
                    }
                });
                
                if (error) {
                    console.error('Registration error:', error);
                    return { 
                        success: false, 
                        error: error.message.includes('already registered') 
                            ? 'Email already registered. Please login instead.'
                            : 'Registration failed: ' + error.message
                    };
                }
                
                // User created successfully!
                console.log('User created:', data.user);
                
                // Store in localStorage as backup
                const users = JSON.parse(localStorage.getItem('getrich_users') || '[]');
                users.push({
                    id: data.user.id,
                    email: userData.email,
                    full_name: userData.full_name,
                    username: userData.username,
                    phone: userData.phone,
                    created_at: new Date().toISOString(),
                    balance: 0.00
                });
                localStorage.setItem('getrich_users', JSON.stringify(users));
                
                return { 
                    success: true, 
                    data: data,
                    message: 'Account created successfully! Please check your email to confirm your account.'
                };
                
            } catch (error) {
                console.error('Error:', error);
                return { 
                    success: false, 
                    error: 'Network error. Please try again.' 
                };
            }
        }
        
        // Form submission handler
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Collect form data
            const userData = {
                full_name: document.getElementById('fullName').value.trim(),
                email: document.getElementById('email').value.trim(),
                username: document.getElementById('username').value.trim(),
                phone: document.getElementById('phone').value.trim() || null,
                is_over_21: document.getElementById('ageConfirm').checked,
                agreed_to_terms: document.getElementById('termsConfirm').checked,
                receive_promotions: document.getElementById('promotions').checked
            };
            
            // Show loading
            const submitBtn = document.querySelector('.submit-btn');
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating Account...';
            submitBtn.disabled = true;
            
            // Register user
            const result = await registerUser(userData);
            
            if (result.success) {
                // Show success message
                document.getElementById('successMessage').innerHTML = `
                    <h3><i class="fas fa-check-circle"></i> Account Created Successfully!</h3>
                    <p>${result.message}</p>
                    <p>You have been awarded $0.00 welcome bonus.</p>
                    <p>Make your first deposit to receive $100 free credit!</p>
                    <p>Redirecting to login...</p>
                `;
                document.getElementById('successMessage').style.display = 'block';
                document.getElementById('registerForm').style.display = 'none';
                
                // Redirect to login after 5 seconds
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 5000);
            } else {
                // Show error
                alert('Error: ' + result.error);
                submitBtn.innerHTML = 'Create Account';
                submitBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
